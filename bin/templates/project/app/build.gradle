/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.3/userguide/java_library_plugin.html
 */


buildscript {
	repositories {
        mavenCentral()
    }
}

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'application'
}


// os specific
def os = System.getProperty("os.name").toLowerCase()
def arch = System.getProperty("os.arch").toLowerCase()
def osgi_platform = '';
def vmArgs = []

switch (arch) {
    case "amd64":
    case "x86_64":
        arch = "x86_64"
        break
    case "x86":
    case "i386":
    case "i686":
        arch = "x86"
        break
}

if (os.contains("windows")) {
	osgi_platform = "win32.win32.${arch}";
} else if (os.contains("linux")) { 
	osgi_platform = "gtk.linux.${arch}"; 
} else if (os.contains("mac")) { 
	osgi_platform = "cocoa.macosx.${arch}"; 
	vmArgs = ['-XstartOnFirstThread']
}

configurations.all {
    resolutionStrategy {
        dependencySubstitution {
            // The maven property ${osgi.platform} is not handled by Gradle
            // so we replace the dependency, using the osgi platform from the project settings
            substitute module('org.eclipse.platform:org.eclipse.swt.${osgi.platform}') with module("org.eclipse.platform:org.eclipse.swt.$osgi_platform:3.116.100")
        }
    }
}

sourceSets {
    main {
        resources {
            srcDir 'src/main/resources' 
            srcDir 'src/main/assets'
        }

    }
 }

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenLocal()
    mavenCentral()
}

def aspectj_version = '1.9.1';
configurations {
	aspectjweaver
}
dependencies {
    aspectjweaver "org.aspectj:aspectjweaver:${aspectj_version}"
}

// PLUGIN GRADLE EXTENSIONS START"
// PLUGIN GRADLE EXTENSIONS END

tasks.withType(Copy).all { duplicatesStrategy 'exclude' }

apply plugin : "java" 

ext {
   javaMainClass = "com.ashera.swt.starter.TestApp"
}

if (os.contains("mac")) { 
	// only for mac
	vmArgs += "-javaagent:" + configurations.aspectjweaver.asPath;
}

application {
    mainClassName = javaMainClass
	applicationDefaultJvmArgs =  vmArgs
    
}